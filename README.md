# gomosaic

## 简介
gomosaic是基于gdal库，用go语言开发的影像镶嵌数据集，当前功能只有两个。
1. build 输入tiff影像文件所在的路径，和要生成的镶嵌数据的路径，生成镶嵌数据集。
内部做了三个事情：
1）把tiff转为cog tiff，即面向云优化的tiff；
2）生成一个鸟瞰图，即在tiff文件之上的更综合的tiff
3）生成json配置文件，保存必要的信息
2. service 发布所生成的镶嵌数据集，在小比例尺浏览时使用鸟瞰图的tiff，在放大到一定程度后自动切换为具体的tiff数据，以获取效果和性能的平衡

## 性能情况
本地，255个tiff，共40GB，12CPU，build时间为12分钟

## TODO LIST
### 测试并优化OSS上的数据
    oss 下载 200mb：1分钟；上传 200mb：30秒；关键看网速；应该差不多。
### 通过本地/内存缓存进一步加速；OK
### 进一步性能优化方案
    内网oss地址：内网测试。。。。。。OK 性能非常好！
    gdal 的open消耗时间有点多；增加数据集的内存池；OK    

### 数据处理的断点续传
### 对目录扫描和json文件读写，屏蔽oss和本地磁盘的差异
### 检查源tiff是否为cog
### 要求源tiff的元数据必须都一致
### 对超大规模，应该增加多层鸟瞰图

gomosic 研发过程
1，应该性能会很好
2，gogis的基础
3，自己写一个镶嵌：cog + 鸟瞰图 + json配置文件
4，本地很好，oss性能差
5，增加内存缓存；重复浏览性能OK了，但不解决第一次浏览慢的问题
6，gdal Open 花费时间多；增加 dataset的内存池
7，dataset IO时间长；切换到oss内网

